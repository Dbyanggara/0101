--// CONFIG
local config = {
    fpsCap = 9999,
    disableChat = true,
    enableBigButton = true,
    bigButtonScaleFactor = 2,
    shakeSpeed = 0.05,
    FreezeWhileFishing = true
}

pcall(function() setfpscap(config.fpsCap) end)

--// SERVICES
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VIM = game:GetService("VirtualInputManager")
local StarterGui = game:GetService("StarterGui")

if config.disableChat then
    pcall(function() StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.Chat, false) end)
end

--// UTILITY
local function simulateClick(x, y)
    if game:GetService("UserInputService").TouchEnabled then
        -- Mobile
        VIM:SendTouchEvent(x, y, 0, true, game, 1)
        task.wait(0.05)
        VIM:SendTouchEvent(x, y, 0, false, game, 1)
    else
        -- PC
        VIM:SendMouseButtonEvent(x, y, 0, true, game, 1)
        task.wait(0.01)
        VIM:SendMouseButtonEvent(x, y, 0, false, game, 1)
    end
end

--// FARM
local Farm = {}

function Farm.findRod()
    local char = LocalPlayer.Character
    if not char then return nil end
    for _, tool in ipairs(char:GetChildren()) do
        if tool:IsA("Tool") and (tool.Name:lower():find("rod")) then
            return tool
        end
    end
    return nil
end

function Farm.freeze(freeze)
    local char = LocalPlayer.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if hum then
        hum.WalkSpeed = freeze and 0 or 16
        hum.JumpPower = freeze and 0 or 50
    end
end

function Farm.cast()
    local rod = Farm.findRod()
    if rod and rod:FindFirstChild("events") and rod.events:FindFirstChild("cast") then
        rod.events.cast:FireServer(100,1)
    end
end

function Farm.shake()
    local shake_ui = PlayerGui:FindFirstChild("shakeui")
    if shake_ui then
        local btn = shake_ui:FindFirstChild("safezone") and shake_ui.safezone:FindFirstChild("button")
        if btn and btn.Visible then
            if config.enableBigButton then
                btn.Size = UDim2.new(config.bigButtonScaleFactor,0,config.bigButtonScaleFactor,0)
            end
            simulateClick(btn.AbsolutePosition.X + btn.AbsoluteSize.X/2,
                          btn.AbsolutePosition.Y + btn.AbsoluteSize.Y/2)
        end
    end
end

function Farm.reel()
    local ev = ReplicatedStorage:FindFirstChild("events")
    if ev and ev:FindFirstChild("reelfinished") then
        ev.reelfinished:FireServer(100,true)
    end
end

--// GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AutoFishGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game:GetService("CoreGui")

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 180, 0, 90)
Frame.Position = UDim2.new(0.05, 0, 0.2, 0)
Frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
Frame.Active = true
Frame.Draggable = true

local StartBtn = Instance.new("TextButton", Frame)
StartBtn.Size = UDim2.new(1, -10, 0, 35)
StartBtn.Position = UDim2.new(0, 5, 0, 5)
StartBtn.Text = "▶ Start"
StartBtn.BackgroundColor3 = Color3.fromRGB(70,130,70)
StartBtn.TextColor3 = Color3.new(1,1,1)
StartBtn.Font = Enum.Font.SourceSansBold
StartBtn.TextSize = 16

local CloseBtn = Instance.new("TextButton", Frame)
CloseBtn.Size = UDim2.new(0, 30, 0, 25)
CloseBtn.Position = UDim2.new(1, -35, 0, 5)
CloseBtn.Text = "X"
CloseBtn.BackgroundColor3 = Color3.fromRGB(180,50,50)
CloseBtn.TextColor3 = Color3.new(1,1,1)
CloseBtn.Font = Enum.Font.SourceSansBold
CloseBtn.TextSize = 16

-- State
local Running = false
local Loop

StartBtn.MouseButton1Click:Connect(function()
    Running = not Running
    if Running then
        StartBtn.Text = "⏸ Stop"
        StartBtn.BackgroundColor3 = Color3.fromRGB(180,50,50)
        Loop = task.spawn(function()
            while Running do
                local rod = Farm.findRod()
                if rod then
                    if config.FreezeWhileFishing then Farm.freeze(true) end
                    Farm.cast()
                    Farm.shake()
                    Farm.reel()
                else
                    Farm.freeze(false)
                end
                task.wait(config.shakeSpeed)
            end
        end)
    else
        StartBtn.Text = "▶ Start"
        StartBtn.BackgroundColor3 = Color3.fromRGB(70,130,70)
        Farm.freeze(false)
    end
end)

CloseBtn.MouseButton1Click:Connect(function()
    if Loop then Running = false end
    ScreenGui:Destroy()
end)
